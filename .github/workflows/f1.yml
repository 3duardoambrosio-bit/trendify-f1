name: F1 Gates

on:
  push:
  pull_request:

jobs:
  f1:
    runs-on: windows-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install deps (best-effort, repo-aware)
        shell: pwsh
        run: |
          python -m pip install --upgrade pip
          if (Test-Path "pyproject.toml") {
            try { python -m pip install -e ".[dev]" } catch { python -m pip install -e . }
          } elseif (Test-Path "requirements-dev.txt") {
            python -m pip install -r requirements-dev.txt
          } elseif (Test-Path "requirements.txt") {
            python -m pip install -r requirements.txt
            python -m pip install pytest
          python -m pip install hypothesis
          } else {
            python -m pip install pytest
          }

      - name: F1 preflight
        shell: pwsh
        run: |
          git config --global core.autocrlf false
          git config --global core.safecrlf true
          powershell -NoProfile -ExecutionPolicy Bypass -File .\tools\invoke_f1_preflight.ps1
